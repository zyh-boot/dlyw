<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1">
		<title>工作台</title>
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" th:href="@{../app/css/weui.min.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{../app/css/jquery-weui.min.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{../app/font/iconfont.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{../app/css/content.css}"/>
		<link rel="stylesheet" type="text/css" th:href="@{../app/css/main.css}"/>
		<style type="text/css">
			.weui-btn+.weui-btn {
				margin-top: 0;
			}
			.btns {
				display: inline-block;
				margin-right: 10px;
				/*margin-bottom: -6px;*/
			}
			.weui-flex {
				border: none;
				color: #fff;
				font-size: 14px;
				text-align: center;
			}
			.weui-cell__ft {
				width: 65px;
			}
		</style>
	</head>
		
	<body>
		<div class="title-head">
			正常工作模式
		</div>
		<div class="weui-tab" style="height: calc(100% - 106px);background: #071449;">
			<div class="weui-navbar">
				<a class="weui-navbar__item weui-bar__item--on" href="#tab1">
					手动
				</a>
				<a class="weui-navbar__item" href="#tab2">
					自动
				</a>
				<a class="weui-navbar__item" href="#tab3">
					阶段
				</a>
			</div>
			<div class="weui-tab__bd">
				<div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active" style="height: 100%">
					<div class="xz_title">电量信息</div>
					<div class="weui-grids">
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								A相电量
							</p>
							<p class="weui-grid__label">
								电压：36V
							</p>
							<p class="weui-grid__label">
								电流：367A
							</p>
							<p class="weui-grid__label">
								电流：367A
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								B相电量
							</p>
							<p class="weui-grid__label">
								电压：36V

							</p>
							<p class="weui-grid__label">
								电流：36A
							</p>
							<p class="weui-grid__label">
								电流：367A
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								C相电量
							</p>
							<p class="weui-grid__label">
								电压：36V

							</p>
							<p class="weui-grid__label">
								电流：36A
							</p>
							<p class="weui-grid__label">
								电流：36A
							</p>
						</a>
					</div>
					<div class="xz_title">实时状态</div>
					<div class="weui-grids">
						
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-tishengji iconSize"></i>
							</div>
							<p class="weui-grid__label">
								进料信息
							</p>
							
							<div class="weui-flex">
							    <div class="weui-flex__item textRight">
							    	频率:
							    </div>
							    <div class="weui-flex__item">
							    	1
							    </div>
							</div>
							<div class="weui-flex">
							    <div class="weui-flex__item textRight" >
							    	功率:
							    </div>
							    <div class="weui-flex__item">
							    	2222222
							    </div>
							</div>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-juanfatongdanse iconSize"></i>
							</div>
							<p class="weui-grid__label">
								滚筒信息
							</p>
							
							<div class="weui-flex">
							    <div class="weui-flex__item textRight">
							    	频率:
							    </div>
							    <div class="weui-flex__item">
							    	1
							    </div>
							</div>
							<div class="weui-flex">
							    <div class="weui-flex__item textRight" >
							    	功率:
							    </div>
							    <div class="weui-flex__item">
							    	2222222
							    </div>
							</div>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-gongrezhiliang iconSize"></i>
							</div>
							<p class="weui-grid__label">
								加热信息
							</p>
							
							<div class="weui-flex">
							    <div class="weui-flex__item textRight">
							    	频率:
							    </div>
							    <div class="weui-flex__item">
							    	1
							    </div>
							</div>
							<div class="weui-flex">
							    <div class="weui-flex__item textRight" >
							    	功率:
							    </div>
							    <div class="weui-flex__item">
							    	2222222
							    </div>
							</div>
						</a>
					</div>
					<div class="xz_title">进料操作按钮</div>
					<div class="weui-cells" style="margin-top: 0;">
						<div class="weui-cell">
						    <div class="weui-cell__bd">
						        <div class="weui-slider-box" id="slider1">
								<div class="weui-slider">
									<div id="sliderInner" class="weui-slider__inner">
										<div id="sliderTrack" class="weui-slider__track"></div>
										<div id="sliderHandler" class="weui-slider__handler"></div>
									</div>
								</div>
								<div id="sliderValue" class="weui-slider-box__value">0</div>
							</div>
						    </div>
						    <div class="weui-cell__ft">
						    	<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-kaiguan btnIcon" ></a>
						    </div>
						</div>
					</div>
					<div class="xz_title">滚筒操作按钮</div>
					<div class="weui-cells" style="margin-top: 0;">
						<div class="weui-cell">
						    <div class="weui-cell__bd">
						        <div class="weui-slider-box" id="slider1">
								<div class="weui-slider">
									<div id="sliderInner" class="weui-slider__inner">
										<div id="sliderTrack" class="weui-slider__track"></div>
										<div id="sliderHandler" class="weui-slider__handler"></div>
									</div>
								</div>
								<div id="sliderValue" class="weui-slider-box__value">0</div>
							</div>
						    </div>
						    <div class="weui-cell__ft">
						    	<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-kaiguan btnIcon" style="margin-bottom: 25px;"></a>
						    	<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-zheng btnIcon btns"></a>
						    </div>
						</div>
					</div>
					<div class="xz_title">加热操作按钮</div>
					<div class="weui-cells" style="margin-top: 0;">
						<div class="weui-cell">
						    <div class="weui-cell__bd">
						        <div class="weui-slider-box" id="slider1">
								<div class="weui-slider">
									<div id="sliderInner" class="weui-slider__inner">
										<div id="sliderTrack" class="weui-slider__track"></div>
										<div id="sliderHandler" class="weui-slider__handler"></div>
									</div>
								</div>
								<div id="sliderValue" class="weui-slider-box__value">0</div>
							</div>
						    </div>
						    <div class="weui-cell__ft">
						    	<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-kaiguan btnIcon" ></a>
						    </div>
						</div>
					</div>
					<!--<div class="weui-grids">
						<div class="weui-grid js_grid">
							
						</div>
						<div class="weui-grid js_grid">
							<div class="weui-slider-box" id="slider2">
								<div class="weui-slider">
									<div id="sliderInner" class="weui-slider__inner">
										<div id="sliderTrack" class="weui-slider__track"></div>
										<div id="sliderHandler" class="weui-slider__handler"></div>
									</div>
								</div>
								<div id="sliderValue" class="weui-slider-box__value">0</div>
							</div>
						</div>
						<div class="weui-grid js_grid">
							<div class="weui-slider-box" id="slider3">
								<div class="weui-slider">
									<div id="sliderInner" class="weui-slider__inner">
										<div id="sliderTrack" class="weui-slider__track"></div>
										<div id="sliderHandler" class="weui-slider__handler"></div>
									</div>
								</div>
								<div id="sliderValue" class="weui-slider-box__value">0</div>
							</div>
						</div>
						<div class="weui-grid js_grid">
							<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-kaiguan btnIcon" ></a>
						</div>
						<div class="weui-grid js_grid">
							<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-kaiguan btnIcon btns"></a>
							<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-zheng btnIcon btns"></a>
						</div>
						<div class="weui-grid js_grid">
							<a href="javascript:;" class="weui-btn weui-btn_primary iconfont icon-kaiguan btnIcon"></a>
						</div>
					</div>-->
				</div>
				
				<div id="tab2" class="weui-tab__bd-item">
					<div class="weui-grids">
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-dianyabiao iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电压：362V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-dianyabiao iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电压：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-dianyabiao iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电压：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电流：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电流：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电流：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-tishengji iconSize"></i>
							</div>
							<p class="weui-grid__label">
								提升机
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-juanfatongdanse iconSize"></i>
							</div>
							<p class="weui-grid__label">
								加热滚筒
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-gongrezhiliang iconSize"></i>
							</div>
							<p class="weui-grid__label">
								冷却床
							</p>
						</a>
					</div>
				</div>
				<div id="tab3" class="weui-tab__bd-item">
					<div class="weui-grids">
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-dianyabiao iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电压：363V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-dianyabiao iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电压：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-dianyabiao iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电压：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电流：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电流：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-icon-current iconSize"></i>
							</div>
							<p class="weui-grid__label">
								电流：36V
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-tishengji iconSize"></i>
							</div>
							<p class="weui-grid__label">
								提升机
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-juanfatongdanse iconSize"></i>
							</div>
							<p class="weui-grid__label">
								加热滚筒
							</p>
						</a>
						<a href="" class="weui-grid js_grid">
							<div class="weui-grid__icon">
								<i class="iconfont icon-gongrezhiliang iconSize"></i>
							</div>
							<p class="weui-grid__label">
								冷却床
							</p>
						</a>
					</div>
				</div>
			</div>
		</div>

		<div class="weui-tabbar">
			<a href="index.html" class="weui-tabbar__item">
				<div class="weui-tabbar__icon">
					<i class="weui-tabbar__label iconfont icon-shouye"></i>
				</div>
				<p class="weui-tabbar__label">首页</p>
			</a>
			<a href="Event.html" class="weui-tabbar__item">
				<div class="weui-tabbar__icon">
					<i class="weui-tabbar__label iconfont icon-shijianguanli"></i>
				</div>
				<p class="weui-tabbar__label">事件</p>
			</a>
			<a href="workbench.html" class="weui-tabbar__item weui-bar__item--on">
				<i class="weui-tabbar__label iconfont icon-gongzuotai" style="font-size: 27px;"></i>
			</a>
			<a href="historyData.html" class="weui-tabbar__item">
				<div class="weui-tabbar__icon">
					<i class="weui-tabbar__label iconfont icon-lishi"></i>
				</div>
				<p class="weui-tabbar__label">历史</p>
			</a>
			<a href="mine.html" class="weui-tabbar__item">
				<div class="weui-tabbar__icon">
					<i class="weui-tabbar__label iconfont icon-wode"></i>
				</div>
				<p class="weui-tabbar__label">我的</p>
			</a>
		</div>
	</body>
	<!-- body 最后 -->
	<script th:src="@{app/js/jquery-3.4.1.min.js}" type="text/javascript" charset="utf-8"></script>
	<script th:src="@{app/js/jquery-weui.min.js}" type="text/javascript" charset="utf-8"></script>
	<script th:src="@{app/js/fastclick.js}" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		//ios系统点击事件的200毫秒延迟
		$(function() {
			FastClick.attach(document.body);
		});
	</script>
	<script type="text/javascript">
		$('#slider1').slider(function(percent) {
			console.log(percent)
		})
		openSocket();
		function openSocket() {
			if (typeof (WebSocket) == "undefined") {
				console.log("您的浏览器不支持WebSocket");
			} else {
				let lockReconnect = false;//避免重复链接
				let socketUrl = 'ws://' + uri + "/imserver/" + $("#userId").val();
				let tt;//时间间隔
				let $scope = new WebSocket(socketUrl);
				//创建webSocket链接
				$scope.createWebSocket = function (socketUrl) {
					try {
						socket = new WebSocket(socketUrl);
						$scope.webSocketInit();//初始化webSocket连接函数
					} catch (e) {
						console.log('catch');
						$scope.webSocketReconnect(socketUrl)//重连函数
					}
				};

				//初始化方法
				$scope.webSocketInit = function () {
					socket.onclose = function () {//连接关闭函数
						console.log("连接已关闭...");
						$scope.webSocketReconnect(socketUrl)//如果连接关闭则重连
					};
					socket.onerror = function () {//连接错误函数
						console.log("连接错误...");
						$scope.webSocketReconnect(socketUrl)//如果连接错误则重连
					};
					socket.onopen = function () {//连接建立
						let message1 = '{message:"hello word"}';
						socket.send(message1);//webSocket业务订阅——可以有多个业务
						//心跳检测启动
						$scope.heartCheck.start();//订阅业务发送之后启动心跳检测机制
					};
					//业务订阅成功后接受服务端推送消息
					socket.onmessage = function (evt) {
						let DATA = evt.data;
						if(DATA !=="连接成功"){
							$view.find("#newMessage").text(DATA);
							$view.find("#newMessage").click();
						}

						//接收一次后台推送的消息，即进行一次心跳检测重置
						$scope.heartCheck.reset();
					};
				};
				$scope.webSocketReconnect = function (url) {
					console.log("socket 连接断开，正在尝试重新建立连接");
					if (lockReconnect) {
						return;
					}
					lockReconnect = true;
					//没连接上会一直重连，设置延迟，避免请求过多
					tt && clearTimeout(tt);
					tt = setTimeout(function () {
						$scope.createWebSocket(url);
					}, 40000)
				};
				//心跳检测
				$scope.heartCheck = {
					timeout: 30000,//30秒
					timeoutObj: null,
					reset: function () {//接收成功一次推送，就将心跳检测的倒计时重置为30秒
						clearTimeout(this.timeoutObj);//重置倒计时
						this.start();
					},
					start: function () {//启动心跳检测机制，设置倒计时30秒一次
						this.timeoutObj = setTimeout(function () {
							var message = '{message:"心跳"}';
							socket.send(message);//启动心跳
						}, this.timeout)
					}
					//onopen连接上，就开始start及时，如果在定时时间范围内，onmessage获取到了服务端消息，就重置reset倒计时，距离上次从后端获取消息30秒后，执行心跳检测，看是不是断了。
				};
				$scope.createWebSocket(socketUrl);//开始创建webSocket连接

			}
		}



	</script>

</html>